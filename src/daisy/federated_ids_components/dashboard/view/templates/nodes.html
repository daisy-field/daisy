<!--
  ~ Copyright (C) 2024 DAI-Labor and others
  ~
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at https://mozilla.org/MPL/2.0/.
  -->
{% extends "./base.html" %}

{% block body_theme %}
{% if dark_theme %}
"sb-nav-fixed bg-dark"
{% else %}
"sb-nav-fixed"
{% endif %}
{% endblock %}

{% block footer_theme %}
{% if dark_theme %}
"py-4 bg-dark mt-auto"
{% else %}
"py-4 mt-auto"
{% endif %}
{% endblock %}

{% block navbar_theme %}
{% if dark_theme %}
"sb-sidenav accordion sb-sidenav-dark"
{% else %}
"sb-sidenav accordion sb-sidenav-light"
{% endif %}
{% endblock %}

{% block main %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://www.gstatic.com/charts/loader.js" type="text/javascript"></script>

<script type="text/javascript">
    function createcard(title, time) {
        var card = '<div class={% if dark_theme %}' +
            '"card bg-dark text-white mb-4" {% else %} "card mb-4" {% endif %}>' +
            '<div class="card-header"> <i class="fa-solid fa-grip-vertical"></i> ' + title + '</div>' +
            '<div id="updated" class="card-footer small text-muted"></div> </div>' //<div className="card-body"></div>

        return card
    }

    function sendRequest() {
        $.ajax({
            url: "http://127.0.0.1:8000/node/",
            type: "GET",
            dataType: "json",
            success: (response) => {

                var Cards = ""

                var currentdate = new Date();
                var datetime = +currentdate.getDate() + "/"
                    + (currentdate.getMonth() + 1) + "/"
                    + currentdate.getFullYear() + " -- "
                    + currentdate.getHours() + ":"
                    + currentdate.getMinutes() + ":"
                    + currentdate.getSeconds();

                for (let i = 0; i < response.length; i++) {        //type = danger, warning, info
                    Cards = Cards + createcard(response[i].address, datetime)
                }


                document.getElementById('content').innerHTML = Cards

            },
            error: (error) => {
                console.log(error);
            }

        })
    }

    sendRequest();
    setInterval(sendRequest, 3000);
</script>


<h1 class="mt-4"></h1>

<div id="content">


</div>


{% endblock %}
