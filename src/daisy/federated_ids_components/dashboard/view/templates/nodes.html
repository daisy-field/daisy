<!--
  ~ Copyright (C) 2024 DAI-Labor and others
  ~
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at https://mozilla.org/MPL/2.0/.
  -->
{% extends "./base.html" %}

{% block body_theme %}
{% if dark_theme %}
"sb-nav-fixed bg-dark"
{% else %}
"sb-nav-fixed"
{% endif %}
{% endblock %}

{% block footer_theme %}
{% if dark_theme %}
"py-4 bg-dark mt-auto"
{% else %}
"py-4 mt-auto"
{% endif %}
{% endblock %}

{% block navbar_theme %}
{% if dark_theme %}
"sb-sidenav accordion sb-sidenav-dark"
{% else %}
"sb-sidenav accordion sb-sidenav-light"
{% endif %}
{% endblock %}

{% block main %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
    function createcard(title, time){
            var card = '<div class={% if dark_theme %}'+
                '"card bg-dark text-white mb-4" {% else %} "card mb-4" {% endif %}>'+
                '<div class="card-header"> <i class="fa-solid fa-grip-vertical"></i> '+ title +'</div>' +
                '<div id="updated" class="card-footer small text-muted"></div> </div>' //<div className="card-body"></div>

        return card
        }
         function sendRequest() {
             $.ajax({
                 url: "http://127.0.0.1:8000/node/",
                 type: "GET",
                 dataType: "json",
                 success: (response) => {

                     var Cards =""

                     var currentdate = new Date();
                     var datetime = +currentdate.getDate() + "/"
                         + (currentdate.getMonth() + 1) + "/"
                         + currentdate.getFullYear() + " -- "
                         + currentdate.getHours() + ":"
                         + currentdate.getMinutes() + ":"
                         + currentdate.getSeconds();

                     for (let i = 0; i < response.length; i++) {        //type = danger, warning, info
                         Cards = Cards + createcard(response[i].address, datetime )
                             }


                    document.getElementById('content').innerHTML   = Cards

                 },
                 error: (error) => {
                     console.log(error);
                 }

             })
         }

        sendRequest();
        setInterval(sendRequest, 3000);
</script>


<h1 class="mt-4"></h1>
<html>
<head>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 700px;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>
<div id="mynetwork"></div>

<script type="text/javascript">
    // create an array with nodes
    serverurl ="https://freesvg.org/img/1373811890.png"
    url = "https://www.svgrepo.com/show/41324/cube.svg"
    var nodes = new vis.DataSet([
        {id: 1,shape: "image",
      image:serverurl , label: 'Evaluation Server', color: "#948e8e"},
        {id: 6,shape: "image",
      image:serverurl , label: 'Aggregation Server', color: "#948e8e"},
        {id: 7 ,shape: "image",
      image:serverurl , label: 'Prediction Server', color: "#948e8e"},
        {id: 2,shape: "image",
      image:url , label: 'Node 2', color:"#eeeeee"},
        {id: 3,shape: "image",
      image: url , label: 'Node 3',  color:"#eeeeee"},
        {id: 4, shape: "image",
      image:url ,label: 'Node 4',  color:"#eeeeee"},
        {id: 5,shape: "image",
      image:url, label: 'Node 5',  color:"#eeeeee"}
    ]);

    // create an array with edges
    var edges = new vis.DataSet([
        {from: 1, to: 3},
        {from: 6, to: 3},
        {from: 6, to: 4},
        {from: 6, to: 5},
        {from: 1, to: 2},
        {from: 7, to: 4},
        {from: 1, to: 5}
    ]);

    // create a network
    var container = document.getElementById('mynetwork');

    // provide the data in the vis format
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = { edges: {
    smooth: {
      type: 'dynamic'
    }},
     interaction: {
    zoomSpeed: 0.5 // Lower this value to reduce the zoom speed (default is 1)
  }};

    // initialize your network!
    var network = new vis.Network(container, data, options);
</script>


{% endblock %}
